<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.5">
<title>moog.physics.physics API documentation</title>
<meta name="description" content="Physics class â€¦">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source > summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible;min-width:max-content}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin:1em 0}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
/* Collapse source docstrings */
setTimeout(() => {
[...document.querySelectorAll('.hljs.language-python > .hljs-string')]
.filter(el => el.innerHTML.length > 200 && ['"""', "'''"].includes(el.innerHTML.substring(0, 3)))
.forEach(el => {
let d = document.createElement('details');
d.classList.add('hljs-string');
d.innerHTML = '<summary>"""</summary>' + el.innerHTML.substring(3);
el.replaceWith(d);
});
}, 100);
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>moog.physics.physics</code></h1>
</header>
<section id="section-intro">
<p>Physics class.</p>
<p>The <code>physics</code> argument to ..environment.Environment is typically an instance of
the Physics class in this file.</p>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="moog.physics.physics.Physics"><code class="flex name class">
<span>class <span class="ident">Physics</span></span>
<span>(</span><span>*forces, updates_per_env_step=1, corrective_physics=())</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Physics(abstract_physics.AbstractPhysics):
    &#34;&#34;&#34;Force physics class.&#34;&#34;&#34;

    def __init__(self, *forces, updates_per_env_step=1, corrective_physics=()):
        &#34;&#34;&#34;Constructor.

        Examples of usage:

            ```python
            friction_force = Friction(coeff_friction=1)
            spring_force = Spring(equilibrium=0.3, spring_const=0.1)
            collision_force = Collision(elasticity=0.5)

            # Specify only friction on the avatar sprite(s)
            force = (friction_force, &#39;avatar&#39;)
            my_physics = Physics(force)

            # Specify friction on the avatar and prey sprite(s)
            force = (friction_force, [&#39;avatar&#39;, &#39;prey&#39;])
            my_physics = Physics(force)

            # Specify friction on avatar and springs between avatar and all prey
            forces = (
                (friction_force, &#39;avatar&#39;),
                (spring_force, &#39;avatar&#39;, &#39;prey&#39;),
            )
            my_physics = Physics(*forces)

            # Add collisions between all avatar/prey sprites and walls/neutrals
            forces = (
                (friction_force, &#39;avatar&#39;),
                (spring_force, &#39;avatar&#39;, &#39;prey&#39;),
                (collision_force, [&#39;avatar&#39;, &#39;prey&#39;], [&#39;walls&#39;, &#39;neutrals&#39;]),
            )
            my_physics = Physics(*forces)
            ```

        Args:
            *forces: Iterable. Each element is a tuple (force_instance, *args)
                where force_instance is an instance of
                abstract_force.AbstractForce and *args has the same length as
                the number of arguments of force_instance&#39;s step() method. Each
                element of args may be either a string key of the environment
                state or an iterable of such. This specifies all sprites to feed
                into the force.
            updates_per_env_step: Int. Number of physics applications per step
                of the environment. A higher value means smoother physics but
                slower runtime. This is fed into the individual forces so that
                they can accomodate their force strength accordingly.
            corrective_physics: Optional instance (or iterable of instances) of
                abstract_physics.AbstractPhysics to be applied every step before
                updating the sprite positions. This is typically used to apply
                corrections to sprite velocities. For example, it can be used to
                enforce rigid tethers between sprites. 
        &#34;&#34;&#34;
        super(Physics, self).__init__(updates_per_env_step=updates_per_env_step)
        self._forces = forces
        if not isinstance(corrective_physics, (list, tuple)):
            corrective_physics = [corrective_physics]
        self._corrective_physics = corrective_physics
    
    def reset(self, state):
        for force in self._forces:
            force[0].reset(state)
        
        for corrective_physics in self._corrective_physics:
            corrective_physics.reset(state)

    def _args_to_iterables(self, args_iterables):
        &#34;&#34;&#34;Converts all non-iterable elements to singleton tuples.&#34;&#34;&#34;
        args_iterables = [
            x if isinstance(x, (tuple, list)) else (x,)
            for x in args_iterables
        ]
        return args_iterables

    def apply_physics(self, state, updates_per_env_step):
        &#34;&#34;&#34;Move the sprites according to the physics.&#34;&#34;&#34;

        # Update sprites based on forces
        for (force, *args_iterables) in self._forces:
            args_iterables = self._args_to_iterables(args_iterables)

            # If args_iterables = [[&#39;avatar&#39;, &#39;prey&#39;], [&#39;walls&#39;, &#39;neutrals&#39;]],
            # then
            # args_combinations = [
            #   [&#39;avatar&#39;, &#39;walls&#39;],
            #   [&#39;avatar&#39;, &#39;neutrals&#39;],
            #   [&#39;prey&#39;, &#39;walls&#39;],
            #   [&#39;prey&#39;, &#39;neutrals&#39;],
            # ]
            args_combinations = itertools.product(*args_iterables)

            for args in args_combinations:
                for sprites in itertools.product(*[state[s] for s in args]):
                    force.step(
                        *sprites, updates_per_env_step=updates_per_env_step)

        for corrective_physics in self._corrective_physics:
            corrective_physics.apply_physics(state, updates_per_env_step)

        # Move sprites based on their velocity
        delta_t = 1. / updates_per_env_step
        for layer in state:
            for sprite in state[layer]:
                sprite.update_pos_from_vel(delta_t=delta_t)</code></pre>
</details>
<div class="desc"><p>Force physics class.</p>
<p>Constructor.</p>
<p>Examples of usage:</p>
<pre><code>```python
friction_force = Friction(coeff_friction=1)
spring_force = Spring(equilibrium=0.3, spring_const=0.1)
collision_force = Collision(elasticity=0.5)

# Specify only friction on the avatar sprite(s)
force = (friction_force, 'avatar')
my_physics = Physics(force)

# Specify friction on the avatar and prey sprite(s)
force = (friction_force, ['avatar', 'prey'])
my_physics = Physics(force)

# Specify friction on avatar and springs between avatar and all prey
forces = (
    (friction_force, 'avatar'),
    (spring_force, 'avatar', 'prey'),
)
my_physics = Physics(*forces)

# Add collisions between all avatar/prey sprites and walls/neutrals
forces = (
    (friction_force, 'avatar'),
    (spring_force, 'avatar', 'prey'),
    (collision_force, ['avatar', 'prey'], ['walls', 'neutrals']),
)
my_physics = Physics(*forces)
```
</code></pre>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>*forces</code></strong></dt>
<dd>Iterable. Each element is a tuple (force_instance, <em>args)
where force_instance is an instance of
abstract_force.AbstractForce and </em>args has the same length as
the number of arguments of force_instance's step() method. Each
element of args may be either a string key of the environment
state or an iterable of such. This specifies all sprites to feed
into the force.</dd>
<dt><strong><code>updates_per_env_step</code></strong></dt>
<dd>Int. Number of physics applications per step
of the environment. A higher value means smoother physics but
slower runtime. This is fed into the individual forces so that
they can accomodate their force strength accordingly.</dd>
<dt><strong><code>corrective_physics</code></strong></dt>
<dd>Optional instance (or iterable of instances) of
abstract_physics.AbstractPhysics to be applied every step before
updating the sprite positions. This is typically used to apply
corrections to sprite velocities. For example, it can be used to
enforce rigid tethers between sprites.</dd>
</dl></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="moog.physics.abstract_physics.AbstractPhysics" href="abstract_physics.html#moog.physics.abstract_physics.AbstractPhysics">AbstractPhysics</a></li>
<li>abc.ABC</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="moog.physics.physics.Physics.apply_physics"><code class="name flex">
<span>def <span class="ident">apply_physics</span></span>(<span>self, state, updates_per_env_step)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def apply_physics(self, state, updates_per_env_step):
    &#34;&#34;&#34;Move the sprites according to the physics.&#34;&#34;&#34;

    # Update sprites based on forces
    for (force, *args_iterables) in self._forces:
        args_iterables = self._args_to_iterables(args_iterables)

        # If args_iterables = [[&#39;avatar&#39;, &#39;prey&#39;], [&#39;walls&#39;, &#39;neutrals&#39;]],
        # then
        # args_combinations = [
        #   [&#39;avatar&#39;, &#39;walls&#39;],
        #   [&#39;avatar&#39;, &#39;neutrals&#39;],
        #   [&#39;prey&#39;, &#39;walls&#39;],
        #   [&#39;prey&#39;, &#39;neutrals&#39;],
        # ]
        args_combinations = itertools.product(*args_iterables)

        for args in args_combinations:
            for sprites in itertools.product(*[state[s] for s in args]):
                force.step(
                    *sprites, updates_per_env_step=updates_per_env_step)

    for corrective_physics in self._corrective_physics:
        corrective_physics.apply_physics(state, updates_per_env_step)

    # Move sprites based on their velocity
    delta_t = 1. / updates_per_env_step
    for layer in state:
        for sprite in state[layer]:
            sprite.update_pos_from_vel(delta_t=delta_t)</code></pre>
</details>
<div class="desc"><p>Move the sprites according to the physics.</p></div>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="moog.physics.abstract_physics.AbstractPhysics" href="abstract_physics.html#moog.physics.abstract_physics.AbstractPhysics">AbstractPhysics</a></b></code>:
<ul class="hlist">
<li><code><a title="moog.physics.abstract_physics.AbstractPhysics.reset" href="abstract_physics.html#moog.physics.abstract_physics.AbstractPhysics.reset">reset</a></code></li>
<li><code><a title="moog.physics.abstract_physics.AbstractPhysics.step" href="abstract_physics.html#moog.physics.abstract_physics.AbstractPhysics.step">step</a></code></li>
<li><code><a title="moog.physics.abstract_physics.AbstractPhysics.updates_per_env_step" href="abstract_physics.html#moog.physics.abstract_physics.AbstractPhysics.updates_per_env_step">updates_per_env_step</a></code></li>
</ul>
</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="moog.physics" href="index.html">moog.physics</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="moog.physics.physics.Physics" href="#moog.physics.physics.Physics">Physics</a></code></h4>
<ul class="">
<li><code><a title="moog.physics.physics.Physics.apply_physics" href="#moog.physics.physics.Physics.apply_physics">apply_physics</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.5</a>.</p>
</footer>
</body>
</html>
